@page
@model Fall2025_Project3_jppierre.Pages.Movies.DetailsModel

@{
    ViewData["Title"] = "Details";
}

<h1>Movie Details</h1>

<div>
    <hr />
    <dl class="row">
   <dt class="col-sm-2">
 @Html.DisplayNameFor(model => model.Movie.Title)
  </dt>
 <dd class="col-sm-10">
    @Html.DisplayFor(model => model.Movie.Title)
</dd>
   <dt class="col-sm-2">
   @Html.DisplayNameFor(model => model.Movie.IMDBLink)
     </dt>
   <dd class="col-sm-10">
     @if (!string.IsNullOrEmpty(Model.Movie.IMDBLink))
  {
   <a href="@Model.Movie.IMDBLink" target="_blank">@Model.Movie.IMDBLink</a>
      }
  else
  {
   @Html.DisplayFor(model => model.Movie.IMDBLink)
}
  </dd>
      <dt class="col-sm-2">
    @Html.DisplayNameFor(model => model.Movie.Genre)
   </dt>
  <dd class="col-sm-10">
@Html.DisplayFor(model => model.Movie.Genre)
  </dd>
   <dt class="col-sm-2">
      @Html.DisplayNameFor(model => model.Movie.ReleaseYear)
 </dt>
  <dd class="col-sm-10">
       @Html.DisplayFor(model => model.Movie.ReleaseYear)
     </dd>
<dt class="col-sm-2">
Poster
  </dt>
<dd class="col-sm-10">
  @if (Model.Movie.Poster != null && Model.Movie.Poster.Length > 0)
   {
    <img src="data:image/jpeg;base64,@Convert.ToBase64String(Model.Movie.Poster)" 
   alt="Movie Poster" 
   style="max-width: 300px; max-height: 400px;" 
  class="img-thumbnail" />
  }
else
  {
     <p>No poster available</p>
    }
    </dd>
    </dl>
</div>

<!-- Actors in Movie Section -->
<div class="mt-4">
    <h4>Actors in this Movie</h4>
    <hr />
    @if (Model.ActorsInMovie.Any())
    {
  <ul class="list-group">
   @foreach (var actor in Model.ActorsInMovie)
 {
     <li class="list-group-item">
   <strong>@actor.Name</strong>
     @if (actor.Photo != null && actor.Photo.Length > 0)
   {
     <img src="data:image/jpeg;base64,@Convert.ToBase64String(actor.Photo)" 
       alt="@actor.Name" 
    style="max-width: 40px; max-height: 40px; margin-left: 10px;" 
        class="rounded-circle" />
   }
    </li>
     }
        </ul>
    }
    else
    {
        <p class="text-muted">No actors linked to this movie yet.</p>
    }
</div>

<!-- AI Reviews and Sentiment Analysis Section -->
<div class="mt-5">
    <h4>AI-Generated Reviews & Sentiment Analysis</h4>
    <hr />
    
    @{
   var sentimentLabel = Model.AverageSentiment switch
        {
     > 0.3 => "Very Positive",
> 0.0 => "Positive",
    > -0.3 => "Neutral",
  > -0.7 => "Negative",
  _ => "Very Negative"
        };
var sentimentColor = Model.AverageSentiment switch
    {
   > 0.0 => "success",
  > -0.3 => "warning",
    _ => "danger"
 };
    }
    
    <div class="alert alert-@sentimentColor" role="alert">
        <h5 class="alert-heading">Overall Sentiment: @sentimentLabel</h5>
<p>Average Sentiment Score: <strong>@Model.AverageSentiment.ToString("F2")</strong></p>
 <small>Based on @Model.Reviews.Count AI-generated reviews</small>
    </div>

    @if (Model.Reviews.Any())
    {
   <table class="table table-striped table-bordered">
      <thead class="thead-dark">
     <tr>
       <th style="width: 70%;">AI-Generated Review</th>
     <th style="width: 30%;">Sentiment Analysis</th>
  </tr>
      </thead>
 <tbody>
      @for (int i = 0; i < Model.Reviews.Count; i++)
    {
   var sentimentClass = Model.Sentiments[i] switch
     {
    "Positive" => "table-success",
  "Negative" => "table-danger",
     _ => "table-warning"
      };
       <tr class="@sentimentClass">
        <td>@Model.Reviews[i]</td>
         <td>
       <span class="badge badge-pill badge-@(Model.Sentiments[i] == "Positive" ? "success" : Model.Sentiments[i] == "Negative" ? "danger" : "secondary")">
      @Model.Sentiments[i]
 </span>
     </td>
      </tr>
     }
  </tbody>
   </table>
    }
    else
    {
        <p class="text-muted">No reviews generated.</p>
    }
</div>

<div class="mt-3">
    <a asp-page="./Edit" asp-route-id="@Model.Movie.Id" class="btn btn-warning">Edit</a>
 <a asp-page="./Index" class="btn btn-secondary">Back to List</a>
</div>
